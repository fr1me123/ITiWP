<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</title>
    <link rel="stylesheet" type="text/css" href="1.css">
</head>

<body>

    <h2>–ê–Ω–∫–µ—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (10 —á–µ–ª–æ–≤–µ–∫)</h2>
    <table id="employeeTable">
        <thead>
            <tr>
                <th>–§–∞–º–∏–ª–∏—è</th>
                <th>–î–∞—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞</th>
                <th>–°—Ä–æ–∫ (–ª–µ—Ç)</th>
            </tr>
        </thead>
        <tbody>
            <!-- –°—Ç—Ä–æ–∫–∏ —Å input –¥–ª—è 10 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
            <script>
                for (let i = 0; i < 10; i++) {
                    document.write(`
                        <tr>
                            <td><input type="text" class="surname"></td>
                            <td><input type="date" class="startDate"></td>
                            <td><input type="number" class="duration" min="1" max="50"></td>
                        </tr>
                    `);
                }
            </script>
        </tbody>
    </table>

    <h3>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>

    <label>–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –≥–æ–¥–∞:
        <select id="season">
            <option value="">--</option>
            <option value="winter">–ó–∏–º–∞</option>
            <option value="spring">–í–µ—Å–Ω–∞</option>
            <option value="summer">–õ–µ—Ç–æ</option>
            <option value="autumn">–û—Å–µ–Ω—å</option>
        </select>
    </label>
    <button onclick="filterBySeason()">–ü–æ –≤—Ä–µ–º–µ–Ω–∏ –≥–æ–¥–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</button>

    <br><label>–ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∞–ª–∞ (1‚Äì4):
        <input type="number" id="quarter" min="1" max="4">
    </label>
    <button onclick="filterByQuarter()">–ü–æ –∫–≤–∞—Ä—Ç–∞–ª—É –æ–∫–æ–Ω—á–∞–Ω–∏—è</button>

    <br><label>–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤:
        <input type="date" id="activeDate">
    </label>
    <button onclick="filterActiveOnDate()">–ê–∫—Ç–∏–≤–Ω—ã –Ω–∞ –¥–∞—Ç—É</button>

    <br><label>–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤:
        <input type="date" id="expiredDate">
    </label>
    <button onclick="filterExpiredOnDate()">–ó–∞–≤–µ—Ä—à–µ–Ω—ã –Ω–∞ –¥–∞—Ç—É</button>

    <br><br>
    <button onclick="clearStorage()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

    <div id="results"></div>

    <script>
        const STORAGE_KEY = "employeesData";

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener("DOMContentLoaded", () => {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                const data = JSON.parse(stored);
                const surnames = document.querySelectorAll(".surname");
                const startDates = document.querySelectorAll(".startDate");
                const durations = document.querySelectorAll(".duration");

                for (let i = 0; i < data.length; i++) {
                    if (data[i]) {
                        surnames[i].value = data[i].name || "";
                        startDates[i].value = data[i].startDate || "";
                        durations[i].value = data[i].duration || "";
                    }
                }
            }

            addInputListeners();
        });

        function addInputListeners() {
            const inputs = document.querySelectorAll(".surname, .startDate, .duration");
            inputs.forEach(input => {
                input.addEventListener("input", saveToLocalStorage);
            });
        }

        function saveToLocalStorage() {
            const surnames = document.querySelectorAll(".surname");
            const startDates = document.querySelectorAll(".startDate");
            const durations = document.querySelectorAll(".duration");

            const employees = [];
            for (let i = 0; i < surnames.length; i++) {
                employees.push({
                    name: surnames[i].value,
                    startDate: startDates[i].value,
                    duration: durations[i].value
                });
            }
            localStorage.setItem(STORAGE_KEY, JSON.stringify(employees));
        }

        function parseEmployees() {
            const surnames = document.querySelectorAll(".surname");
            const startDates = document.querySelectorAll(".startDate");
            const durations = document.querySelectorAll(".duration");

            const employees = [];
            for (let i = 0; i < surnames.length; i++) {
                if (surnames[i].value && startDates[i].value && durations[i].value) {
                    const start = new Date(startDates[i].value);
                    const end = new Date(start);
                    end.setFullYear(end.getFullYear() + parseInt(durations[i].value));
                    employees.push({
                        name: surnames[i].value,
                        startDate: start,
                        endDate: end
                    });
                }
            }
            return employees;
        }

        function filterBySeason() {
            const season = document.getElementById("season").value;
            const seasonMonths = {
                winter: [11, 0, 1],
                spring: [2, 3, 4],
                summer: [5, 6, 7],
                autumn: [8, 9, 10]
            };
            const employees = parseEmployees();
            const results = employees.filter(e =>
                seasonMonths[season]?.includes(e.endDate.getMonth())
            );
            showResults(`–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–µ–∑–æ–Ω:`, results);
        }

        function filterByQuarter() {
            const q = parseInt(document.getElementById("quarter").value);
            const employees = parseEmployees();
            const results = employees.filter(e => {
                const month = e.endDate.getMonth();
                const quarter = Math.floor(month / 3) + 1;
                return quarter === q;
            });
            showResults(`–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –≤ ${q}-–º –∫–≤–∞—Ä—Ç–∞–ª–µ:`, results);
        }

        function filterActiveOnDate() {
            const d = new Date(document.getElementById("activeDate").value);
            const employees = parseEmployees();
            const results = employees.filter(e =>
                d >= e.startDate && d < e.endDate
            );
            showResults(`–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∞–∫—Ç–∏–≤–Ω—ã –Ω–∞ ${d.toLocaleDateString()}:`, results);
        }

        function filterExpiredOnDate() {
            const d = new Date(document.getElementById("expiredDate").value);
            const employees = parseEmployees();
            const results = employees.filter(e =>
                d >= e.endDate
            );
            showResults(`–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã –Ω–∞ ${d.toLocaleDateString()}:`, results);
        }

        function showResults(title, employees) {
            const lines = employees.map(e =>
                `${e.name}: ${e.endDate.toLocaleDateString()}`
            );
            document.getElementById("results").innerText =
                `${title}\n` + (lines.length ? lines.join("\n") : "–ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π");
        }

        function clearStorage() {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    </script>

</body>

</html>